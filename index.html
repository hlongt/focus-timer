<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¸“æ³¨ç©ºé—´ | ç²¾ç¡®è®¡æ—¶</title>
    <style>
        :root {
            --bg: #020617; --panel: #111827; --text: #e5e7eb;
            --sub: #a5b4fc; --list: #0b1220; --total: #0b1220;
            --accent: #22c55e;
        }
        .light {
            --bg: #fafafa; --panel: #ffffff; --text: #111827;
            --sub: #2563eb; --list: #f1f5f9; --total: #f1f5f9;
            --accent: #2563eb;
        }

        /* è·¨å¹³å°åŸºç¡€ä¿®å¤ */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { -webkit-text-size-adjust: 100%; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Microsoft YaHei", sans-serif;
            background: var(--bg); color: var(--text);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; padding: 15px;
            transition: background 0.3s ease;
        }

        .box {
            background: var(--panel);
            padding: clamp(20px, 5vw, 35px);
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 480px;
            transition: transform 0.2s ease;
        }

        .top-bar { display: flex; justify-content: space-between; margin-bottom: 20px; }
        
        .toggle-btn {
            padding: 8px 14px; border-radius: 12px;
            background: rgba(128,128,128,0.15); border: none; color: var(--text);
            cursor: pointer; font-size: 13px; font-weight: 500;
        }

        .section-title {
            margin-top: 20px; font-size: 13px; color: var(--sub);
            display: flex; justify-content: space-between; align-items: center;
            letter-spacing: 1px; text-transform: uppercase;
        }

        .time-now { font-size: 1.2rem; text-align: center; font-weight: 300; opacity: 0.8; }
        
        .counter-big {
            font-size: clamp(50px, 15vw, 72px);
            text-align: center; margin: 15px 0 25px;
            font-weight: 700;
            font-variant-numeric: tabular-nums; /* å…³é”®ï¼šé˜²æ­¢æ•°å­—è·³åŠ¨ */
            font-family: "Courier New", Courier, monospace; /* ç­‰å®½å­—ä½“ä¿è¯è®¡æ—¶è§†è§‰ç¨³å®š */
        }

        .btn-group { display: flex; gap: 10px; margin-bottom: 5px; }
        
        button.ctrl-btn {
            padding: 14px 10px; border: none; border-radius: 14px;
            font-size: 16px; font-weight: 600; cursor: pointer; flex: 1;
            transition: opacity 0.2s, transform 0.1s;
        }
        button.ctrl-btn:active { transform: scale(0.96); }
        
        .start { background: #22c55e; color: #fff; }
        .pause { background: #facc15; color: #000; }
        .reset { background: #f87171; color: #fff; }

        .info-panel {
            margin-top: 20px; background: var(--list);
            padding: 18px; border-radius: 18px;
        }
        
        .total-row {
            font-size: 14px; font-weight: 700;
            display: flex; justify-content: space-between;
            padding-bottom: 10px; border-bottom: 1px solid rgba(128,128,128,0.1);
        }

        .history-list {
            text-align: left; max-height: 150px; overflow-y: auto;
            margin-top: 12px; font-size: 13px; line-height: 1.8;
        }

        .clear-btn {
            padding: 4px 10px; border-radius: 8px;
            background: rgba(239, 68, 68, 0.2); border: none; 
            color: #f87171; font-size: 11px; cursor: pointer;
        }

        .footer {
            position: absolute; bottom: 20px; width: 100%;
            text-align: center; font-size: 12px; color: var(--sub);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .footer a { color: inherit; text-decoration: none; opacity: 0.7; }
    </style>
</head>
<body>

<div class="box">
    <div class="top-bar">
        <button class="toggle-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™ æ·±è‰²</button>
        <button class="toggle-btn" onclick="toggleLang()" id="langBtn">English</button>
    </div>

    <div class="section-title" id="t-now">å½“å‰æ—¶é—´</div>
    <div id="clock" class="time-now">00:00:00</div>

    <div class="section-title" id="t-focus">ä¸“æ³¨è®¡æ—¶</div>
    <div id="focus" class="counter-big">00:00:00</div>

    <div class="btn-group">
        <button class="ctrl-btn start" onclick="handleStart()" id="b-start">å¼€å§‹</button>
        <button class="ctrl-btn pause" onclick="handlePause()" id="b-pause">æš‚åœ</button>
        <button class="ctrl-btn reset" onclick="handleFinish()" id="b-finish">å®Œæˆ</button>
    </div>

    <div class="section-title">
        <span id="t-history">å†å²è®°å½•</span>
        <button class="clear-btn" onclick="clearHistory()" id="clearBtn">æ¸…ç©º</button>
    </div>

    <div class="info-panel">
        <div class="total-row">
            <span id="t-total">ç´¯è®¡ä¸“æ³¨</span>
            <span id="total">00:00:00</span>
        </div>
        <div class="history-list" id="history">æš‚æ— è®°å½•</div>
    </div>
</div>

<div class="footer">
    <a href="mailto:longtao.huang@outlook.com">ğŸ“« Contact: longtao.huang@outlook.com</a>
</div>

<script>
    // --- çŠ¶æ€ç®¡ç† ---
    let lang = localStorage.getItem("lang") || "cn";
    let theme = localStorage.getItem("theme") || "dark";
    
    // æ ¸å¿ƒè®¡æ—¶å˜é‡
    let timer = null;
    let startTime = 0;       // é€»è¾‘èµ·å§‹æ—¶é—´æˆ³
    let currentFocusSec = 0; // å½“å‰æ˜¾ç¤ºçš„ç§’æ•°
    let accumulatedSec = 0;  // æš‚åœæ—¶ä¿å­˜çš„å·²è®¡ç§’æ•°
    
    let totalSec = Number(localStorage.getItem("totalAll")) || 0;
    let sessions = JSON.parse(localStorage.getItem("sessions") || "[]");

    const text = {
        cn: { now:"å½“å‰æ—¶é—´", focus:"ä¸“æ³¨è®¡æ—¶", history:"å†å²è®°å½•", total:"ç´¯è®¡ä¸“æ³¨", start:"å¼€å§‹", pause:"æš‚åœ", finish:"å®Œæˆ", none:"æš‚æ— è®°å½•", themeLight:"ğŸŒ æµ…è‰²", themeDark:"ğŸŒ™ æ·±è‰²", langBtn:"English", clear:"æ¸…ç©º", confirm:"ç¡®å®šæ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿ" },
        en: { now:"Current Time", focus:"Focusing", history:"History", total:"Total Time", start:"Start", pause:"Pause", finish:"Finish", none:"No Records", themeLight:"ğŸŒ Light", themeDark:"ğŸŒ™ Dark", langBtn:"ä¸­æ–‡", clear:"Clear", confirm:"Clear all history?" }
    };

    // --- æ ¸å¿ƒè®¡æ—¶é€»è¾‘ (æ—¶é—´æˆ³å¯¹æ¯”æ³•) ---
    function handleStart() {
        if (timer) return;
        // å…³é”®ç‚¹ï¼šè®¾ç½®èµ·å§‹ç‚¹ä¸ºï¼ˆå½“å‰æ—¶é—´ - å·²ç´¯è®¡æ—¶é—´ï¼‰
        startTime = Date.now() - (accumulatedSec * 1000);
        
        timer = setInterval(() => {
            const now = Date.now();
            // å®æ—¶é€šè¿‡æ—¶é—´æˆ³å·®å€¼è®¡ç®—ï¼Œè¯¯å·®æ°¸è¿œä¸º0
            currentFocusSec = Math.floor((now - startTime) / 1000);
            document.getElementById("focus").innerText = format(currentFocusSec);
        }, 200); // è¾ƒé«˜é¢‘ç‡æ£€æŸ¥ä¿è¯UIæµç•…
    }

    function handlePause() {
        if (!timer) return;
        clearInterval(timer);
        timer = null;
        accumulatedSec = currentFocusSec; // æš‚åœæ—¶æš‚å­˜ç§’æ•°
    }

    function handleFinish() {
        if (currentFocusSec === 0) return;
        handlePause();

        // å­˜å…¥å†å²
        totalSec += currentFocusSec;
        localStorage.setItem("totalAll", totalSec);
        
        const now = new Date();
        const timeStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
        
        sessions.unshift({ duration: currentFocusSec, time: timeStr });
        localStorage.setItem("sessions", JSON.stringify(sessions.slice(0, 50))); // ä¿ç•™æœ€è¿‘50æ¡

        // é‡ç½®çŠ¶æ€
        currentFocusSec = 0;
        accumulatedSec = 0;
        document.getElementById("focus").innerText = "00:00:00";
        renderUI();
    }

    // --- UI æ›´æ–°é€»è¾‘ ---
    function format(s) {
        const h = Math.floor(s / 3600).toString().padStart(2, "0");
        const m = Math.floor((s % 3600) / 60).toString().padStart(2, "0");
        const sec = (s % 60).toString().padStart(2, "0");
        return `${h}:${m}:${sec}`;
    }

    function renderUI() {
        const t = text[lang];
        document.getElementById("t-now").innerText = t.now;
        document.getElementById("t-focus").innerText = t.focus;
        document.getElementById("t-history").innerText = t.history;
        document.getElementById("t-total").innerText = t.total;
        document.getElementById("b-start").innerText = t.start;
        document.getElementById("b-pause").innerText = t.pause;
        document.getElementById("b-finish").innerText = t.finish;
        document.getElementById("langBtn").innerText = t.langBtn;
        document.getElementById("clearBtn").innerText = t.clear;

        document.getElementById("total").innerText = format(totalSec);
        const listBody = document.getElementById("history");
        listBody.innerHTML = sessions.length 
            ? sessions.map(s => `<div style="display:flex; justify-content:space-between; opacity:0.8; border-bottom:1px solid rgba(128,128,128,0.05)"><span>ğŸ“Œ ${s.time}</span><span>${format(s.duration)}</span></div>`).join("")
            : t.none;

        // ä¸»é¢˜åˆ‡æ¢
        document.body.className = theme === "light" ? "light" : "";
        document.getElementById("themeBtn").innerText = theme === "light" ? t.themeDark : t.themeLight;
    }

    function toggleLang() {
        lang = lang === "cn" ? "en" : "cn";
        localStorage.setItem("lang", lang);
        renderUI();
    }

    function toggleTheme() {
        theme = theme === "dark" ? "light" : "dark";
        localStorage.setItem("theme", theme);
        renderUI();
    }

    function clearHistory() {
        if (!confirm(text[lang].confirm)) return;
        sessions = []; totalSec = 0;
        localStorage.clear();
        renderUI();
    }

    // æ—¶é’Ÿ
    function updateClock() {
        document.getElementById("clock").innerText = new Date().toLocaleTimeString();
    }

    // --- åˆå§‹åŒ– ---
    setInterval(updateClock, 1000);
    updateClock();
    renderUI();
</script>

</body>
</html>
