<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ä¸“æ³¨è®¡æ—¶ğŸ…</title>
<style>
:root{
    --bg:#020617;
    --panel:#111827;
    --text:#e5e7eb;
    --sub:#a5b4fc;
    --list:#0b1220;
    --total:#0b1220;
}
.light{
    --bg:#fafafa;
    --panel:#ffffff;
    --text:#111827;
    --sub:#2563eb;
    --list:#f1f5f9;
    --total:#f1f5f9;
}

body{
    font-family:"Microsoft YaHei";
    background:var(--bg);
    color:var(--text);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
    transition: background 0.4s ease;
}

.box{
    background:var(--panel);
    padding:35px 55px;
    border-radius:22px;
    box-shadow:0 0 30px rgba(0,0,0,.35);
    width:500px;
    transition: background 0.4s ease;
}

.top-bar{
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
}


button {
    padding: 10px 18px;
    margin: 6px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    outline: none;
}


button:hover {
    filter: brightness(1.1);
    transform: translateY(-1px);
}


button:active {
    transform: translateY(1px);
    filter: brightness(0.9);
}

.toggle-btn{
    padding:6px 12px;
    border-radius:10px;
    background:#374151;
    color:#fff;
    min-width: 110px;
    font-size: 14px;
}
.light .toggle-btn{ background:#cbd5e1; color:#000;}

.section-title{
    margin-top:14px;
    font-size:15px;
    color:var(--sub);
    display:flex;
    justify-content:space-between;
    align-items:center;
    transition: color 0.4s ease;
}

.clear-btn{
    padding:4px 10px;
    border-radius:8px;
    background:#ef4444;
    color:#fff;
    font-size:12px;
    margin: 0;
}

.time{
    font-size:50px;
    text-align:center;
    transition: color 0.4s ease;
}
.counter-big{
    font-size:50px;
    text-align:center;
    margin:5px 0 15px;
    transition: color 0.4s ease;
}

.start{background:#22c55e;color:#000;}
.pause{background:#facc15;color:#000;}
.reset{background:#f87171;color:#000;}

.total-box{
    margin-top:10px;
    background:var(--total);
    padding:10px;
    border-radius:10px;
    font-size:14px;
    transition: background 0.4s ease;
}
.list{
    text-align:left;
    max-height:180px;
    overflow-y:auto;
    margin-top:10px;
    background:var(--list);
    padding:10px;
    border-radius:10px;
    font-size:14px;
    transition: background 0.4s ease;
}
.author-info {
    position: fixed;
    bottom: 0;
    width: 100%;
    font-size: 14px;
    color: var(--sub);
    text-align: center;
    padding: 5px 0; 
    background-color: transparent;
    margin: 0;
}
.author-info a {
    text-decoration: none;
    color: inherit;
}
</style>
</head>
<body>

<div class="box">
    <div class="top-bar">
        <button class="toggle-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ“ è‡ªåŠ¨æ¨¡å¼</button>
        <button class="toggle-btn" onclick="toggleLang()" id="langBtn">ğŸŒ ä¸­æ–‡</button>
    </div>

    <div class="section-title" id="t-now">å½“å‰æ—¶é—´</div>
    <div id="clock" class="time">--:--:--</div>

    <div class="section-title" id="t-focus">ä¸“æ³¨è®¡æ—¶</div>
    <div id="focus" class="counter-big">00:00:00</div>

    <div style="text-align:center;margin-bottom:5px;">
        <button class="start" onclick="start()" id="b-start">å¼€å§‹</button>
        <button class="pause" onclick="pause()" id="b-pause">æš‚åœ</button>
        <button class="reset" onclick="finish()" id="b-finish">ç»“æŸå¹¶ä¿å­˜</button>
    </div>

    <div class="section-title">
        <span id="t-history">å†å²è®°å½•</span>
        <button class="clear-btn" onclick="clearHistory()" id="clearBtn">æ¸…ç©º</button>
    </div>

    <div class="total-box">
        <span id="t-total">ç´¯è®¡æ—¶é•¿ï¼š</span>
        <span id="total">00:00:00</span>
    </div>

    <div class="list" id="history">æš‚æ— è®°å½•</div>
</div>

<div class="author-info">
    <p><a href="https://hlongt.github.io">ğŸ“«Contact me via email to longtao.huang@outlook.com</a></p>
</div>

<script>

let lang = localStorage.getItem("lang") || "cn";
const text = {
    cn:{
        now:"å½“å‰æ—¶é—´", focus:"ä¸“æ³¨è®¡æ—¶", history:"å†å²è®°å½•", total:"ç´¯è®¡æ—¶é•¿ï¼š",
        start:"å¼€å§‹", pause:"æš‚åœ", finish:"ç»“æŸå¹¶ä¿å­˜", none:"æš‚æ— è®°å½•",
        themeLight:"ğŸŒ æµ…è‰²æ¨¡å¼", themeDark:"ğŸŒ™ æ·±è‰²æ¨¡å¼", themeAuto:"ğŸŒ“ è‡ªåŠ¨æ¨¡å¼",
        langLabel:"ğŸŒ ä¸­æ–‡", clear:"æ¸…ç©º"
    },
    en:{
        now:"Current Time", focus:"Focus Timer", history:"History Records", total:"Total Focus Time: ",
        start:"Start", pause:"Pause", finish:"Finish & Save", none:"No Records",
        themeLight:"ğŸŒ Light Mode", themeDark:"ğŸŒ™ Dark Mode", themeAuto:"ğŸŒ“ Auto Mode",
        langLabel:"ğŸŒ English", clear:"Clear"
    }
};

function applyLang(){
    const t = text[lang];
    document.getElementById("t-now").innerText=t.now;
    document.getElementById("t-focus").innerText=t.focus;
    document.getElementById("t-history").innerText=t.history;
    document.getElementById("t-total").innerText=t.total;
    document.getElementById("b-start").innerText=t.start;
    document.getElementById("b-pause").innerText=t.pause;
    document.getElementById("b-finish").innerText=t.finish;
    document.getElementById("clearBtn").innerText=t.clear;
    document.getElementById("langBtn").innerText=t.langLabel;
    
    renderHistory();
    applyTheme();
}

function toggleLang(){
    lang = (lang==="cn"?"en":"cn");
    localStorage.setItem("lang",lang);
    applyLang();
}


let theme = localStorage.getItem("theme") || "auto";

function applyTheme(){
    const hour = new Date().getHours();
    let actualTheme = theme;

    if (theme === "auto") {
        actualTheme = (hour >= 6 && hour < 18) ? "light" : "dark";
    }

    if(actualTheme === "light") document.body.classList.add("light");
    else document.body.classList.remove("light");
    
    const t = text[lang];
    let btnText = "";
    if (theme === "auto") btnText = t.themeAuto;
    else if (theme === "light") btnText = t.themeLight;
    else btnText = t.themeDark;
    
    document.getElementById("themeBtn").innerText = btnText;
}

function toggleTheme(){
    if (theme === "auto") theme = "light";
    else if (theme === "light") theme = "dark";
    else theme = "auto";
    
    localStorage.setItem("theme", theme);
    applyTheme();
}


function updateClock(){
    const now = new Date();
    document.getElementById("clock").innerText = now.toLocaleTimeString();
    if (theme === "auto" && now.getSeconds() === 0) {
        applyTheme();
    }
}
setInterval(updateClock,1000);
updateClock();


function format(s){
    let h = String(Math.floor(s/3600)).padStart(2,"0");
    let m = String(Math.floor((s%3600)/60)).padStart(2,"0");
    let sec = String(s%60).padStart(2,"0");
    return `${h}:${m}:${sec}`;
}

let timer = null;
let totalSec = Number(localStorage.getItem("totalAll")) || 0;
let sessions = JSON.parse(localStorage.getItem("sessions") || "[]");
let baseSec = Number(localStorage.getItem("baseSec")) || 0; 
let startTime = Number(localStorage.getItem("startTime")) || 0; 

function getDisplaySec() {
    if (startTime === 0) return baseSec;
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    return baseSec + elapsed;
}

function updateDisplay() {
    const currentTotal = getDisplaySec();
    document.getElementById("focus").innerText = format(currentTotal);
}

function start(){
    if(timer) return;
    if(startTime === 0) {
        startTime = Date.now();
        localStorage.setItem("startTime", startTime);
    }
    timer = setInterval(updateDisplay, 1000);
}

function pause(){
    if(!timer) return;
    clearInterval(timer);
    timer = null;
    baseSec = getDisplaySec();
    startTime = 0;
    localStorage.setItem("baseSec", baseSec);
    localStorage.removeItem("startTime");
    updateDisplay();
}

function finish(){
    const finalSec = getDisplaySec();
    pause();
    if(finalSec === 0) return;
    
    totalSec += finalSec;
    localStorage.setItem("totalAll", totalSec);
    document.getElementById("total").innerText = format(totalSec);

    sessions.push({
        duration: finalSec,
        time: new Date().toLocaleString()
    });
    localStorage.setItem("sessions", JSON.stringify(sessions));
    
    baseSec = 0;
    startTime = 0;
    localStorage.removeItem("baseSec");
    localStorage.removeItem("startTime");
    document.getElementById("focus").innerText = "00:00:00";
    renderHistory();
}

function renderHistory(){
    const box = document.getElementById("history");
    if(sessions.length === 0){
        box.innerHTML = text[lang].none;
        return;
    }
    box.innerHTML = sessions.map(s => `ğŸ“Œ ${s.time} â€”â€” ${format(s.duration)}`).join("<br>");
}

function clearHistory(){
    const confirmMsg = lang === "cn" ? "ç¡®å®šæ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿ" : "Clear all records?";
    if(!confirm(confirmMsg)) return;

    if(timer) { clearInterval(timer); timer = null; }
    const keysToRemove = ["totalAll", "sessions", "baseSec", "startTime"];
    keysToRemove.forEach(key => localStorage.removeItem(key));

    totalSec = 0; sessions = []; baseSec = 0; startTime = 0;
    document.getElementById("total").innerText = "00:00:00";
    document.getElementById("focus").innerText = "00:00:00";
    renderHistory();
}


document.getElementById("total").innerText = format(totalSec);
applyLang(); 
renderHistory();

if(startTime !== 0 || baseSec !== 0) {
    updateDisplay();
    if(startTime !== 0) start();
}
</script>

</body>
</html>
