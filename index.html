<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ä¸“æ³¨è®¡æ—¶</title>
<style>
:root{
    --bg:#020617;
    --panel:#111827;
    --text:#e5e7eb;
    --sub:#a5b4fc;
    --list:#0b1220;
    --total:#0b1220;
}
.light{
    --bg:#fafafa;
    --panel:#ffffff;
    --text:#111827;
    --sub:#2563eb;
    --list:#f1f5f9;
    --total:#f1f5f9;
}

body{
    font-family:"Microsoft YaHei";
    background:var(--bg);
    color:var(--text);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
}
.box{
    background:var(--panel);
    padding:35px 55px;
    border-radius:22px;
    box-shadow:0 0 30px rgba(0,0,0,.35);
    width:500px;
}
.top-bar{
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
}
.toggle-btn{
    padding:6px 12px;
    border-radius:10px;
    background:#374151;
    border:none;
    color:#fff;
    cursor:pointer;
}
.light .toggle-btn{ background:#cbd5e1; color:#000;}

.section-title{
    margin-top:14px;
    font-size:15px;
    color:var(--sub);
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.clear-btn{
    padding:4px 10px;
    border-radius:8px;
    background:#ef4444;
    border:none;
    color:#000;
    cursor:pointer;
    font-size:12px;
}

.time{
    font-size:50px;
    text-align:center;
}
.counter-big{
    font-size:50px;
    text-align:center;
    margin:5px 0 15px;
}
button{
    padding:10px 18px;
    margin:6px;
    border:none;
    border-radius:12px;
    font-size:16px;
    cursor:pointer;
}
.start{background:#22c55e;color:#000;}
.pause{background:#facc15;color:#000;}
.reset{background:#f87171;color:#000;}

.total-box{
    margin-top:10px;
    background:var(--total);
    padding:10px;
    border-radius:10px;
    font-size:14px;
}
.list{
    text-align:left;
    max-height:180px;
    overflow-y:auto;
    margin-top:10px;
    background:var(--list);
    padding:10px;
    border-radius:10px;
    font-size:14px;
}
.author-info {
    position: fixed;
    bottom: 0;
    width: 100%;
    font-size: 14px;
    color: var(--sub);
    text-align: center;
    padding: 5px 0; 
    background-color: transparent;
    margin: 0;
}
.author-info a {
    text-decoration: none;
    color: inherit;
}


</style>
</head>
<body>

<div class="box">

    <div class="top-bar">
        <button class="toggle-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
        <button class="toggle-btn" onclick="toggleLang()" id="langBtn">English</button>
    </div>

    <div class="section-title" id="t-now">å½“å‰æ—¶é—´</div>
    <div id="clock" class="time">--:--:--</div>

    <div class="section-title" id="t-focus">ä¸“æ³¨è®¡æ—¶</div>
    <div id="focus" class="counter-big">00:00:00</div>

    <div style="text-align:center;margin-bottom:5px;">
        <button class="start" onclick="start()" id="b-start">å¼€å§‹</button>
        <button class="pause" onclick="pause()" id="b-pause">æš‚åœ</button>
        <button class="reset" onclick="finish()" id="b-finish">ç»“æŸå¹¶ä¿å­˜</button>
    </div>

    <!-- å†å²è®°å½• + æ¸…ç©º -->
    <div class="section-title">
        <span id="t-history">å†å²è®°å½•</span>
        <button class="clear-btn" onclick="clearHistory()" id="clearBtn">æ¸…ç©º</button>
    </div>

    <div class="total-box">
        <span id="t-total">ç´¯è®¡æ—¶é•¿ï¼š</span>
        <span id="total">00:00:00</span>
    </div>

    <div class="list" id="history">æš‚æ— è®°å½•</div>

</div>

<div class="author-info">
    <p><a href="https://hlongt.github.io">ğŸ“«Contact me via email to longtao.huang@outlook.com</a></p>
            
</div>

<script>
// ---------- è¯­è¨€ ----------
let lang = localStorage.getItem("lang") || "cn";

const text = {
    cn:{
        now:"å½“å‰æ—¶é—´",
        focus:"ä¸“æ³¨è®¡æ—¶",
        history:"å†å²è®°å½•",
        total:"ç´¯è®¡æ—¶é•¿ï¼š",
        start:"å¼€å§‹",
        pause:"æš‚åœ",
        finish:"ç»“æŸå¹¶ä¿å­˜",
        none:"æš‚æ— è®°å½•",
        themeLight:"ğŸŒ æµ…è‰²æ¨¡å¼",
        themeDark:"ğŸŒ™ æ·±è‰²æ¨¡å¼",
        langBtn:"English",
        clear:"æ¸…ç©º"
    },
    en:{
        now:"Current Time",
        focus:"Focus Timer",
        history:"History Records",
        total:"Total Focus Time: ",
        start:"Start",
        pause:"Pause",
        finish:"Finish & Save",
        none:"No Records",
        themeLight:"ğŸŒ Light Mode",
        themeDark:"ğŸŒ™ Dark Mode",
        langBtn:"ä¸­æ–‡",
        clear:"Clear"
    }
};

function applyLang(){
    const t = text[lang];
    document.getElementById("t-now").innerText=t.now;
    document.getElementById("t-focus").innerText=t.focus;
    document.getElementById("t-history").innerText=t.history;
    document.getElementById("t-total").innerText=t.total;
    document.getElementById("b-start").innerText=t.start;
    document.getElementById("b-pause").innerText=t.pause;
    document.getElementById("b-finish").innerText=t.finish;
    document.getElementById("langBtn").innerText=t.langBtn;
    document.getElementById("clearBtn").innerText=t.clear;
    renderHistory();

    applyTheme();
}
function toggleLang(){
    lang = (lang==="cn"?"en":"cn");
    localStorage.setItem("lang",lang);
    applyLang();
}

// ---------- ä¸»é¢˜ ----------
let theme = localStorage.getItem("theme") || "dark";
function applyTheme(){
    if(theme==="light") document.body.classList.add("light");
    else document.body.classList.remove("light");

    document.getElementById("themeBtn").innerText =
        theme==="light" ? text[lang].themeDark : text[lang].themeLight;
}
function toggleTheme(){
    theme = (theme==="dark"?"light":"dark");
    localStorage.setItem("theme",theme);
    applyTheme();
}

// ---------- æ—¶é’Ÿ ----------
function updateClock(){
    document.getElementById("clock").innerText =
        new Date().toLocaleTimeString();
}
setInterval(updateClock,1000);
updateClock();

// ---------- åŠŸèƒ½ ----------
function format(s){
    let h = String(Math.floor(s/3600)).padStart(2,"0");
    let m = String(Math.floor((s%3600)/60)).padStart(2,"0");
    let sec = String(s%60).padStart(2,"0");
    return `${h}:${m}:${sec}`;
}

let focusSec = Number(localStorage.getItem("focusSec")) || 0;
let timer = null;

let totalSec = Number(localStorage.getItem("totalAll")) || 0;
document.getElementById("total").innerText = format(totalSec);

let sessions = JSON.parse(localStorage.getItem("sessions") || "[]");

function start(){
    if(timer) return;
    let startTime = Date.now();
    localStorage.setItem("startTime", startTime);

    timer = setInterval(() => {
        let elapsed = Math.floor((Date.now() - startTime) / 1000);
        focusSec = elapsed;
        localStorage.setItem("focusSec", focusSec);
        updateFocusDisplay();
    }, 1000);
}

function pause(){
    clearInterval(timer);
    timer = null;
}

function finish(){
    pause();
    if(focusSec===0) return;
    totalSec += focusSec;
    localStorage.setItem("totalAll", totalSec);
    document.getElementById("total").innerText = format(totalSec);

    sessions.push({
        duration:focusSec,
        time:new Date().toLocaleString()
    });
    localStorage.setItem("sessions",JSON.stringify(sessions));

    focusSec = 0;
    localStorage.setItem("focusSec", focusSec);
    updateFocusDisplay();
    renderHistory();
}

function updateFocusDisplay() {
    document.getElementById("focus").innerText = format(focusSec);
}

function renderHistory(){
    const box = document.getElementById("history");
    if(sessions.length === 0){
        box.innerHTML = text[lang].none;
        return;
    }
    box.innerHTML = sessions.map(s =>
        `ğŸ“Œ ${s.time} â€”â€” ${format(s.duration)}`
    ).join("<br>");
}

function clearHistory(){
    if(!confirm(lang==="cn" ? "ç¡®å®šæ¸…ç©ºæ‰€æœ‰å†å²ä¸ç´¯è®¡æ—¶é•¿å—ï¼Ÿ" : "Clear all history and total time?"))
        return;
    sessions = [];
    totalSec = 0;
    localStorage.removeItem("sessions");
    localStorage.removeItem("totalAll");
    localStorage.removeItem("startTime");
    localStorage.removeItem("focusSec");
    document.getElementById("total").innerText = "00:00:00";
    renderHistory();
}

// ---------- é¡µé¢åŠ è½½æ—¶æ¢å¤è®¡æ—¶çŠ¶æ€ ----------
window.onload = function() {
    let startTime = localStorage.getItem("startTime");
    let savedFocusSec = Number(localStorage.getItem("focusSec")) || 0;

    if (startTime) {
        let elapsed = Math.floor((Date.now() - startTime) / 1000);
        focusSec = savedFocusSec + elapsed;
        updateFocusDisplay();

        if (!timer) {
            timer = setInterval(() => {
                focusSec++;
                localStorage.setItem("focusSec", focusSec);
                updateFocusDisplay();
            }, 1000);
        }
    } else {
        focusSec = savedFocusSec;
        updateFocusDisplay();
    }
};

// ---------- åˆå§‹åŒ– ----------
applyLang();
applyTheme();
renderHistory();
</script>

</body>
</html>
